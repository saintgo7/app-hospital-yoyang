# 케어매치(CareMatch) V3 설치 및 배포 가이드

---

## 문서 정보

| 항목 | 내용 |
|------|------|
| 프로젝트명 | 케어매치(CareMatch) V3 |
| 문서버전 | 1.0 |
| 작성일자 | 2026년 1월 2일 |
| 대상 독자 | 개발자, DevOps 엔지니어 |

---

## 목차

1. [사전 요구사항](#1-사전-요구사항)
2. [로컬 개발 환경 설정](#2-로컬-개발-환경-설정)
3. [Supabase 설정](#3-supabase-설정)
4. [소셜 로그인 설정](#4-소셜-로그인-설정)
5. [Vercel 배포](#5-vercel-배포)
6. [환경 변수 설정](#6-환경-변수-설정)
7. [배포 후 확인](#7-배포-후-확인)
8. [트러블슈팅](#8-트러블슈팅)

---

## 1. 사전 요구사항

### 1.1 시스템 요구사항

| 항목 | 최소 요구사항 | 권장 사항 |
|------|-------------|----------|
| Node.js | 18.x 이상 | 20.x LTS |
| pnpm | 8.x 이상 | 최신 버전 |
| Git | 2.x 이상 | 최신 버전 |
| OS | Windows 10, macOS 10.15, Ubuntu 20.04 | 최신 버전 |

### 1.2 계정 요구사항

다음 서비스의 계정이 필요합니다:

| 서비스 | 용도 | 가입 URL |
|--------|------|----------|
| GitHub | 소스코드 관리 | https://github.com |
| Supabase | 데이터베이스, 인증 | https://supabase.com |
| Vercel | 배포 | https://vercel.com |
| Kakao Developers | 카카오 로그인 | https://developers.kakao.com |
| Naver Developers | 네이버 로그인 | https://developers.naver.com |

---

## 2. 로컬 개발 환경 설정

### 2.1 저장소 클론

```bash
# 저장소 클론
git clone https://github.com/saintgo7/app-hospital-yoyang.git

# 디렉토리 이동
cd app-hospital-yoyang
```

### 2.2 의존성 설치

```bash
# pnpm 설치 (미설치 시)
npm install -g pnpm

# 프로젝트 의존성 설치
pnpm install
```

### 2.3 환경 변수 설정

```bash
# 환경 변수 파일 생성
cp .env.example .env.local
```

`.env.local` 파일을 열어 다음 값을 설정합니다:

```env
# Supabase
NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# NextAuth
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=your-random-secret-key

# Kakao OAuth
KAKAO_CLIENT_ID=your-kakao-client-id
KAKAO_CLIENT_SECRET=your-kakao-client-secret

# Naver OAuth
NAVER_CLIENT_ID=your-naver-client-id
NAVER_CLIENT_SECRET=your-naver-client-secret
```

### 2.4 개발 서버 실행

```bash
# 개발 서버 시작
pnpm dev
```

브라우저에서 http://localhost:3000 접속하여 확인합니다.

### 2.5 빌드 테스트

```bash
# 프로덕션 빌드
pnpm build

# 빌드된 앱 실행
pnpm start
```

---

## 3. Supabase 설정

### 3.1 프로젝트 생성

1. https://supabase.com 접속 및 로그인
2. **New Project** 클릭
3. 프로젝트 정보 입력:
   - Name: `carematch-v3`
   - Database Password: 안전한 비밀번호 입력
   - Region: `Northeast Asia (Seoul)` 선택
4. **Create new project** 클릭

### 3.2 데이터베이스 스키마 생성

Supabase SQL Editor에서 다음 쿼리를 실행합니다:

```sql
-- 사용자 테이블
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email VARCHAR(255) UNIQUE NOT NULL,
  name VARCHAR(100) NOT NULL,
  role VARCHAR(20) NOT NULL CHECK (role IN ('caregiver', 'guardian')),
  phone VARCHAR(20),
  image TEXT,
  profile_completed BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 간병인 프로필 테이블
CREATE TABLE caregiver_profiles (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  experience_years INTEGER,
  certifications JSONB,
  introduction TEXT,
  preferred_location VARCHAR(100),
  preferred_salary INTEGER,
  available BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 구인글 테이블
CREATE TABLE job_postings (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  guardian_id UUID REFERENCES users(id) ON DELETE CASCADE,
  title VARCHAR(200) NOT NULL,
  description TEXT NOT NULL,
  location VARCHAR(100) NOT NULL,
  salary INTEGER NOT NULL,
  work_type VARCHAR(20) NOT NULL CHECK (work_type IN ('live_in', 'commute', 'hourly')),
  patient_condition TEXT,
  status VARCHAR(20) DEFAULT 'open' CHECK (status IN ('open', 'closed', 'filled')),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 지원 테이블
CREATE TABLE applications (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  job_id UUID REFERENCES job_postings(id) ON DELETE CASCADE,
  caregiver_id UUID REFERENCES users(id) ON DELETE CASCADE,
  status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('pending', 'accepted', 'rejected')),
  message TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(job_id, caregiver_id)
);

-- 리뷰 테이블
CREATE TABLE reviews (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  job_id UUID REFERENCES job_postings(id) ON DELETE CASCADE,
  reviewer_id UUID REFERENCES users(id) ON DELETE CASCADE,
  reviewee_id UUID REFERENCES users(id) ON DELETE CASCADE,
  rating INTEGER NOT NULL CHECK (rating >= 1 AND rating <= 5),
  comment TEXT NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 채팅방 테이블
CREATE TABLE chat_rooms (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  guardian_id UUID REFERENCES users(id) ON DELETE CASCADE,
  caregiver_id UUID REFERENCES users(id) ON DELETE CASCADE,
  job_id UUID REFERENCES job_postings(id),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(guardian_id, caregiver_id)
);

-- 메시지 테이블
CREATE TABLE messages (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  room_id UUID REFERENCES chat_rooms(id) ON DELETE CASCADE,
  sender_id UUID REFERENCES users(id) ON DELETE CASCADE,
  content TEXT NOT NULL,
  read BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 인덱스 생성
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_role ON users(role);
CREATE INDEX idx_job_postings_status ON job_postings(status);
CREATE INDEX idx_job_postings_location ON job_postings(location);
CREATE INDEX idx_applications_status ON applications(status);
CREATE INDEX idx_messages_room_id ON messages(room_id);
CREATE INDEX idx_messages_created_at ON messages(created_at);
```

### 3.3 Row Level Security (RLS) 설정

```sql
-- RLS 활성화
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE caregiver_profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE job_postings ENABLE ROW LEVEL SECURITY;
ALTER TABLE applications ENABLE ROW LEVEL SECURITY;
ALTER TABLE reviews ENABLE ROW LEVEL SECURITY;
ALTER TABLE chat_rooms ENABLE ROW LEVEL SECURITY;
ALTER TABLE messages ENABLE ROW LEVEL SECURITY;

-- 기본 정책 (예시)
CREATE POLICY "Public users are viewable by everyone"
ON users FOR SELECT
USING (true);

CREATE POLICY "Users can update own profile"
ON users FOR UPDATE
USING (auth.uid() = id);
```

### 3.4 Realtime 활성화

1. Supabase 대시보드에서 **Database** → **Replication** 이동
2. **messages** 테이블에서 **Enable** 클릭

### 3.5 API 키 확인

1. **Settings** → **API** 이동
2. 다음 값을 `.env.local`에 복사:
   - Project URL → `NEXT_PUBLIC_SUPABASE_URL`
   - anon public → `NEXT_PUBLIC_SUPABASE_ANON_KEY`
   - service_role → `SUPABASE_SERVICE_ROLE_KEY`

---

## 4. 소셜 로그인 설정

### 4.1 카카오 로그인

1. https://developers.kakao.com 접속
2. **내 애플리케이션** → **애플리케이션 추가하기**
3. 앱 이름: `케어매치`
4. **플랫폼** → **Web** 추가
   - 사이트 도메인: `http://localhost:3000` (개발용)
   - 프로덕션 도메인 추가
5. **카카오 로그인** 활성화
6. **Redirect URI** 등록:
   - `http://localhost:3000/api/auth/callback/kakao`
   - `https://your-domain.com/api/auth/callback/kakao`
7. **동의항목** 설정:
   - 닉네임: 필수
   - 프로필 사진: 선택
   - 이메일: 필수
8. **앱 키**에서 REST API 키 확인 → `KAKAO_CLIENT_ID`
9. **보안** 탭에서 Client Secret 생성 → `KAKAO_CLIENT_SECRET`

### 4.2 네이버 로그인

1. https://developers.naver.com 접속
2. **Application** → **애플리케이션 등록**
3. 애플리케이션 이름: `케어매치`
4. **사용 API**: 네이버 로그인
5. **제공 정보**: 회원이름, 이메일, 프로필 사진
6. **환경 추가**: PC웹
   - 서비스 URL: `http://localhost:3000`
   - Callback URL: `http://localhost:3000/api/auth/callback/naver`
7. 프로덕션 URL도 추가
8. **Client ID** → `NAVER_CLIENT_ID`
9. **Client Secret** → `NAVER_CLIENT_SECRET`

---

## 5. Vercel 배포

### 5.1 Vercel 연결

1. https://vercel.com 접속 및 GitHub 로그인
2. **Add New** → **Project**
3. GitHub 저장소 선택: `app-hospital-yoyang`
4. **Import**

### 5.2 환경 변수 설정

Vercel 프로젝트 설정에서 환경 변수 추가:

| 변수명 | 값 | 환경 |
|--------|-----|------|
| NEXT_PUBLIC_SUPABASE_URL | Supabase URL | All |
| NEXT_PUBLIC_SUPABASE_ANON_KEY | Supabase Anon Key | All |
| SUPABASE_SERVICE_ROLE_KEY | Supabase Service Key | All |
| NEXTAUTH_URL | 프로덕션 URL | Production |
| NEXTAUTH_SECRET | 랜덤 시크릿 | All |
| KAKAO_CLIENT_ID | 카카오 앱 키 | All |
| KAKAO_CLIENT_SECRET | 카카오 시크릿 | All |
| NAVER_CLIENT_ID | 네이버 앱 ID | All |
| NAVER_CLIENT_SECRET | 네이버 시크릿 | All |

### 5.3 배포

1. 환경 변수 설정 후 **Deploy** 클릭
2. 빌드 로그 확인
3. 배포 완료 후 URL 확인

### 5.4 도메인 설정 (선택)

1. **Settings** → **Domains**
2. 커스텀 도메인 추가
3. DNS 레코드 설정

---

## 6. 환경 변수 설정

### 6.1 전체 환경 변수 목록

```env
# ===========================================
# Supabase
# ===========================================
NEXT_PUBLIC_SUPABASE_URL=https://xxxxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# ===========================================
# NextAuth
# ===========================================
NEXTAUTH_URL=https://your-domain.com
NEXTAUTH_SECRET=your-super-secret-key-min-32-chars

# ===========================================
# Kakao OAuth
# ===========================================
KAKAO_CLIENT_ID=your-kakao-rest-api-key
KAKAO_CLIENT_SECRET=your-kakao-client-secret

# ===========================================
# Naver OAuth
# ===========================================
NAVER_CLIENT_ID=your-naver-client-id
NAVER_CLIENT_SECRET=your-naver-client-secret

# ===========================================
# Kakao Alimtalk (선택)
# ===========================================
KAKAO_ALIMTALK_KEY=your-alimtalk-key
KAKAO_ALIMTALK_SENDER=발신번호
```

### 6.2 시크릿 키 생성

```bash
# NEXTAUTH_SECRET 생성
openssl rand -base64 32
```

---

## 7. 배포 후 확인

### 7.1 기능 테스트 체크리스트

| 기능 | 테스트 항목 | 확인 |
|------|-----------|------|
| 홈페이지 | 페이지 로드, 링크 동작 | ☐ |
| 카카오 로그인 | 로그인 성공, 콜백 처리 | ☐ |
| 네이버 로그인 | 로그인 성공, 콜백 처리 | ☐ |
| 프로필 완성 | 폼 제출, 데이터 저장 | ☐ |
| 구인글 목록 | 데이터 조회, 페이지네이션 | ☐ |
| 구인글 등록 | 폼 제출, 데이터 저장 | ☐ |
| 지원하기 | 지원 처리, 상태 변경 | ☐ |
| 채팅 | 메시지 전송, 실시간 수신 | ☐ |
| 리뷰 | 리뷰 작성, 조회 | ☐ |

### 7.2 성능 테스트

```bash
# Lighthouse 테스트
npx lighthouse https://your-domain.com --view
```

### 7.3 보안 점검

- [ ] HTTPS 적용 확인
- [ ] 환경 변수 노출 여부 확인
- [ ] RLS 정책 동작 확인
- [ ] 인증 필수 API 접근 제한 확인

---

## 8. 트러블슈팅

### 8.1 빌드 오류

**문제**: TypeScript 타입 오류
```bash
# 해결
pnpm typecheck
# 오류 수정 후 재빌드
pnpm build
```

**문제**: 의존성 충돌
```bash
# 해결
rm -rf node_modules pnpm-lock.yaml
pnpm install
```

### 8.2 소셜 로그인 오류

**문제**: Redirect URI 불일치
- 해결: 카카오/네이버 개발자 콘솔에서 정확한 Redirect URI 등록

**문제**: Invalid Client
- 해결: Client ID, Secret 값 확인

### 8.3 데이터베이스 연결 오류

**문제**: Supabase 연결 실패
- 해결: URL, 키 값 확인
- Supabase 프로젝트 상태 확인

**문제**: RLS 정책으로 데이터 접근 불가
- 해결: RLS 정책 검토 및 수정

### 8.4 채팅 실시간 동기화 오류

**문제**: 메시지가 실시간으로 표시되지 않음
- 해결: Supabase Realtime 활성화 확인
- messages 테이블 Replication 설정 확인

---

*본 문서는 케어매치 V3의 설치 및 배포 과정을 안내합니다.*
