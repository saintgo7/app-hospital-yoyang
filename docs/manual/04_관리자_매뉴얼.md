# 케어매치(CareMatch) V3 관리자 매뉴얼

---

## 문서 정보

| 항목 | 내용 |
|------|------|
| 프로젝트명 | 케어매치(CareMatch) V3 |
| 문서버전 | 1.0 |
| 작성일자 | 2026년 1월 2일 |
| 대상 독자 | 시스템 관리자, 운영자 |

---

## 목차

1. [관리자 시스템 개요](#1-관리자-시스템-개요)
2. [Supabase 관리](#2-supabase-관리)
3. [Vercel 배포 관리](#3-vercel-배포-관리)
4. [사용자 관리](#4-사용자-관리)
5. [콘텐츠 관리](#5-콘텐츠-관리)
6. [모니터링](#6-모니터링)
7. [장애 대응](#7-장애-대응)
8. [백업 및 복구](#8-백업-및-복구)

---

## 1. 관리자 시스템 개요

### 1.1 관리 도구

| 도구 | 용도 | 접속 URL |
|------|------|----------|
| Supabase Dashboard | 데이터베이스 관리 | https://supabase.com/dashboard |
| Vercel Dashboard | 배포 및 도메인 관리 | https://vercel.com/dashboard |
| GitHub Repository | 소스코드 관리 | https://github.com/saintgo7/app-hospital-yoyang |

### 1.2 관리자 권한

| 권한 레벨 | 접근 가능 영역 |
|----------|---------------|
| Super Admin | 모든 시스템 설정, 사용자 관리, 데이터 접근 |
| Admin | 사용자 관리, 콘텐츠 관리, 리포트 조회 |
| Operator | 콘텐츠 검토, 신고 처리, 고객 지원 |

---

## 2. Supabase 관리

### 2.1 대시보드 접속

1. https://supabase.com 접속
2. 이메일/비밀번호로 로그인
3. 프로젝트 선택: `carematch-v3`

### 2.2 데이터베이스 관리

#### 테이블 조회

1. 좌측 메뉴에서 **Table Editor** 클릭
2. 원하는 테이블 선택
3. 데이터 조회 및 수정

#### SQL 실행

1. 좌측 메뉴에서 **SQL Editor** 클릭
2. 쿼리 작성 및 실행

**자주 사용하는 쿼리**:

```sql
-- 전체 사용자 수 조회
SELECT COUNT(*) as total_users FROM users;

-- 역할별 사용자 수
SELECT role, COUNT(*) as count
FROM users
GROUP BY role;

-- 최근 가입 사용자 (최근 7일)
SELECT * FROM users
WHERE created_at >= NOW() - INTERVAL '7 days'
ORDER BY created_at DESC;

-- 활성 구인글 수
SELECT COUNT(*) as active_jobs
FROM job_postings
WHERE status = 'open';

-- 일별 지원 현황
SELECT DATE(created_at) as date, COUNT(*) as applications
FROM applications
WHERE created_at >= NOW() - INTERVAL '30 days'
GROUP BY DATE(created_at)
ORDER BY date DESC;
```

### 2.3 인증 관리

1. **Authentication** 메뉴 클릭
2. **Users** 탭에서 사용자 목록 확인
3. 개별 사용자 정보 조회 및 수정

**사용자 상태 변경**:
- Ban User: 계정 정지
- Delete User: 계정 삭제 (주의 필요)

### 2.4 Realtime 모니터링

1. **Realtime** 메뉴 클릭
2. 활성 연결 수 확인
3. 메시지 전송량 모니터링

### 2.5 Storage 관리

1. **Storage** 메뉴 클릭
2. 버킷별 파일 관리
3. 용량 사용량 확인

---

## 3. Vercel 배포 관리

### 3.1 대시보드 접속

1. https://vercel.com 접속
2. GitHub 계정으로 로그인
3. 프로젝트 선택

### 3.2 배포 관리

#### 프로덕션 배포

1. GitHub `main` 브랜치에 푸시하면 자동 배포
2. 배포 상태 확인: Deployments 탭
3. 배포 로그 확인: 개별 배포 클릭

#### 롤백 방법

1. **Deployments** 탭 이동
2. 이전 성공한 배포 찾기
3. **...** 메뉴 클릭 → **Promote to Production**

### 3.3 도메인 관리

1. **Settings** → **Domains** 이동
2. 커스텀 도메인 추가/삭제
3. DNS 설정 확인

### 3.4 환경 변수 관리

1. **Settings** → **Environment Variables** 이동
2. 변수 추가/수정/삭제

**필수 환경 변수**:

| 변수명 | 설명 |
|--------|------|
| NEXT_PUBLIC_SUPABASE_URL | Supabase 프로젝트 URL |
| NEXT_PUBLIC_SUPABASE_ANON_KEY | Supabase 익명 키 |
| SUPABASE_SERVICE_ROLE_KEY | Supabase 서비스 롤 키 |
| NEXTAUTH_URL | 사이트 URL |
| NEXTAUTH_SECRET | 세션 암호화 키 |
| KAKAO_CLIENT_ID | 카카오 앱 키 |
| KAKAO_CLIENT_SECRET | 카카오 시크릿 |
| NAVER_CLIENT_ID | 네이버 앱 ID |
| NAVER_CLIENT_SECRET | 네이버 시크릿 |

### 3.5 분석 및 로그

1. **Analytics** 탭: 방문자 통계
2. **Logs** 탭: 함수 실행 로그
3. **Speed Insights**: 성능 분석

---

## 4. 사용자 관리

### 4.1 사용자 조회

**Supabase SQL**:

```sql
-- 특정 사용자 검색 (이메일)
SELECT * FROM users
WHERE email ILIKE '%검색어%';

-- 특정 사용자 검색 (이름)
SELECT * FROM users
WHERE name ILIKE '%검색어%';

-- 간병인 목록
SELECT u.*, cp.*
FROM users u
LEFT JOIN caregiver_profiles cp ON u.id = cp.user_id
WHERE u.role = 'caregiver';
```

### 4.2 계정 정지

문제가 있는 사용자 계정을 정지하는 방법:

1. Supabase Authentication에서 해당 사용자 찾기
2. **Ban User** 클릭
3. 정지 사유 기록 (내부 문서)

### 4.3 계정 삭제

**주의**: 삭제된 데이터는 복구가 어렵습니다.

```sql
-- 관련 데이터 먼저 삭제 (순서 중요)
DELETE FROM messages WHERE sender_id = '사용자ID';
DELETE FROM chat_rooms WHERE guardian_id = '사용자ID' OR caregiver_id = '사용자ID';
DELETE FROM applications WHERE caregiver_id = '사용자ID';
DELETE FROM reviews WHERE reviewer_id = '사용자ID' OR reviewee_id = '사용자ID';
DELETE FROM job_postings WHERE guardian_id = '사용자ID';
DELETE FROM caregiver_profiles WHERE user_id = '사용자ID';
DELETE FROM users WHERE id = '사용자ID';
```

---

## 5. 콘텐츠 관리

### 5.1 구인글 관리

**부적절한 구인글 삭제**:

```sql
-- 구인글 상태 변경 (비활성화)
UPDATE job_postings
SET status = 'closed'
WHERE id = '구인글ID';

-- 구인글 삭제
DELETE FROM job_postings
WHERE id = '구인글ID';
```

### 5.2 리뷰 관리

**부적절한 리뷰 삭제**:

```sql
-- 리뷰 삭제
DELETE FROM reviews
WHERE id = '리뷰ID';
```

### 5.3 채팅 관리

**특정 채팅방 메시지 조회**:

```sql
SELECT m.*, u.name as sender_name
FROM messages m
JOIN users u ON m.sender_id = u.id
WHERE m.room_id = '채팅방ID'
ORDER BY m.created_at DESC;
```

---

## 6. 모니터링

### 6.1 핵심 지표

| 지표 | 설명 | 확인 위치 |
|------|------|----------|
| DAU | 일일 활성 사용자 | Vercel Analytics |
| 신규 가입 | 일별 신규 가입자 수 | Supabase SQL |
| 구인글 등록 | 일별 새 구인글 수 | Supabase SQL |
| 지원 현황 | 일별 지원 건수 | Supabase SQL |
| 채팅 메시지 | 일별 메시지 발송량 | Supabase SQL |

### 6.2 모니터링 쿼리

```sql
-- 일별 활성 지표 (최근 30일)
SELECT
  DATE(created_at) as date,
  COUNT(DISTINCT id) FILTER (WHERE role = 'caregiver') as new_caregivers,
  COUNT(DISTINCT id) FILTER (WHERE role = 'guardian') as new_guardians
FROM users
WHERE created_at >= NOW() - INTERVAL '30 days'
GROUP BY DATE(created_at)
ORDER BY date DESC;

-- 구인글 현황
SELECT
  status,
  COUNT(*) as count
FROM job_postings
GROUP BY status;

-- 평균 응답 시간 (채팅)
SELECT
  AVG(EXTRACT(EPOCH FROM (created_at - LAG(created_at) OVER (PARTITION BY room_id ORDER BY created_at))))
FROM messages;
```

### 6.3 알림 설정

Vercel에서 알림 설정:
1. **Settings** → **Notifications**
2. 슬랙/이메일 알림 연동
3. 배포 실패, 에러 발생 시 알림

---

## 7. 장애 대응

### 7.1 장애 유형별 대응

#### 사이트 접속 불가

1. Vercel 상태 확인: https://www.vercel-status.com/
2. Supabase 상태 확인: https://status.supabase.com/
3. DNS 설정 확인
4. 최근 배포 확인 및 롤백 검토

#### API 오류

1. Vercel Functions 로그 확인
2. Supabase 연결 상태 확인
3. 환경 변수 확인
4. 에러 로그 분석

#### 데이터베이스 연결 오류

1. Supabase 대시보드 접속 확인
2. 연결 풀 상태 확인
3. RLS 정책 확인

### 7.2 긴급 연락망

| 담당 | 연락처 | 역할 |
|------|--------|------|
| 개발 리드 | dev-lead@company.com | 기술 이슈 대응 |
| 운영 담당 | ops@company.com | 서비스 운영 |
| 경영진 | ceo@company.com | 주요 결정 사항 |

### 7.3 장애 보고서 작성

장애 발생 시 다음 내용을 기록:

1. 장애 발생 시각
2. 장애 인지 시각
3. 장애 현상
4. 영향 범위
5. 조치 내용
6. 복구 시각
7. 근본 원인
8. 재발 방지 대책

---

## 8. 백업 및 복구

### 8.1 자동 백업

Supabase는 자동 백업을 제공합니다:
- Pro 플랜: 일일 백업, 7일 보관
- 백업 확인: **Settings** → **Database** → **Backups**

### 8.2 수동 백업

```bash
# pg_dump를 사용한 수동 백업
pg_dump -h [SUPABASE_HOST] -U postgres -d postgres > backup_$(date +%Y%m%d).sql
```

### 8.3 데이터 복구

1. Supabase 대시보드에서 백업 선택
2. **Restore** 클릭
3. 복구 완료 확인

### 8.4 Point-in-Time Recovery

Pro 플랜에서 제공:
1. **Settings** → **Database** → **Point in Time Recovery**
2. 원하는 시점 선택
3. 복구 실행

---

## 부록: 유용한 SQL 쿼리 모음

### 통계 쿼리

```sql
-- 전체 서비스 현황 요약
SELECT
  (SELECT COUNT(*) FROM users WHERE role = 'caregiver') as total_caregivers,
  (SELECT COUNT(*) FROM users WHERE role = 'guardian') as total_guardians,
  (SELECT COUNT(*) FROM job_postings WHERE status = 'open') as active_jobs,
  (SELECT COUNT(*) FROM applications WHERE status = 'pending') as pending_applications,
  (SELECT COUNT(*) FROM chat_rooms) as total_chat_rooms,
  (SELECT AVG(rating) FROM reviews) as avg_rating;
```

### 데이터 정리 쿼리

```sql
-- 30일 이상 된 마감 구인글 삭제
DELETE FROM job_postings
WHERE status = 'closed'
AND updated_at < NOW() - INTERVAL '30 days';

-- 읽지 않은 오래된 메시지 정리
UPDATE messages
SET read = true
WHERE created_at < NOW() - INTERVAL '90 days';
```

---

*본 문서는 케어매치 V3 시스템 관리자를 위한 가이드입니다.*
