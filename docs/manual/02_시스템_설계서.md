# 케어매치(CareMatch) V3 시스템 설계서

---

## 문서 정보

| 항목 | 내용 |
|------|------|
| 프로젝트명 | 케어매치(CareMatch) V3 |
| 문서버전 | 1.0 |
| 작성일자 | 2026년 1월 2일 |
| 작성자 | 개발팀 |

---

## 1. 시스템 아키텍처

### 1.1 전체 시스템 구성도

```
┌─────────────────────────────────────────────────────────────────┐
│                          사용자 계층                             │
│    ┌──────────────┐    ┌──────────────┐    ┌──────────────┐    │
│    │   간병인      │    │   보호자      │    │   관리자      │    │
│    │  (Mobile)    │    │  (Desktop)   │    │  (Desktop)   │    │
│    └──────────────┘    └──────────────┘    └──────────────┘    │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                        프레젠테이션 계층                          │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │              Next.js (React + TypeScript)                 │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐       │  │
│  │  │   Pages     │  │ Components  │  │   Hooks     │       │  │
│  │  │   Router    │  │ (shadcn/ui) │  │             │       │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘       │  │
│  └───────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                         비즈니스 계층                            │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │                  Next.js API Routes                       │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐       │  │
│  │  │    Auth     │  │    Jobs     │  │    Chat     │       │  │
│  │  │   (Auth.js) │  │   (CRUD)    │  │ (Realtime)  │       │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘       │  │
│  └───────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                         데이터 계층                              │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                    Supabase                              │    │
│  │  ┌───────────┐  ┌───────────┐  ┌───────────┐            │    │
│  │  │PostgreSQL │  │ Realtime  │  │  Storage  │            │    │
│  │  │ (Database)│  │(WebSocket)│  │  (Files)  │            │    │
│  │  └───────────┘  └───────────┘  └───────────┘            │    │
│  └─────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────┘
```

### 1.2 배포 아키텍처

```
┌──────────────────────────────────────────────────────────────┐
│                         Vercel                                │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐       │
│  │   Edge       │  │   Serverless │  │   Static     │       │
│  │   Network    │  │   Functions  │  │   Assets     │       │
│  └──────────────┘  └──────────────┘  └──────────────┘       │
│         │                 │                 │                │
│         └─────────────────┼─────────────────┘                │
│                           │                                  │
└───────────────────────────┼──────────────────────────────────┘
                            │
            ┌───────────────┼───────────────┐
            ▼               ▼               ▼
     ┌───────────┐   ┌───────────┐   ┌───────────┐
     │ Supabase  │   │   Kakao   │   │   Naver   │
     │  (Seoul)  │   │   OAuth   │   │   OAuth   │
     └───────────┘   └───────────┘   └───────────┘
```

---

## 2. 데이터베이스 설계

### 2.1 ERD (Entity Relationship Diagram)

```
┌─────────────────┐       ┌─────────────────┐
│     users       │       │  caregiver_     │
│─────────────────│       │  profiles       │
│ id (PK)         │◄──────│─────────────────│
│ email           │       │ id (PK)         │
│ name            │       │ user_id (FK)    │
│ role            │       │ experience      │
│ phone           │       │ certifications  │
│ created_at      │       │ introduction    │
│ updated_at      │       │ created_at      │
└─────────────────┘       └─────────────────┘
        │
        │ 1:N
        ▼
┌─────────────────┐       ┌─────────────────┐
│   job_postings  │       │  applications   │
│─────────────────│       │─────────────────│
│ id (PK)         │◄──────│ id (PK)         │
│ guardian_id(FK) │       │ job_id (FK)     │
│ title           │       │ caregiver_id(FK)│
│ description     │       │ status          │
│ location        │       │ message         │
│ salary          │       │ created_at      │
│ work_type       │       └─────────────────┘
│ status          │
│ created_at      │
└─────────────────┘
        │
        │ 1:N
        ▼
┌─────────────────┐       ┌─────────────────┐
│    reviews      │       │   chat_rooms    │
│─────────────────│       │─────────────────│
│ id (PK)         │       │ id (PK)         │
│ job_id (FK)     │       │ guardian_id(FK) │
│ reviewer_id(FK) │       │ caregiver_id(FK)│
│ reviewee_id(FK) │       │ job_id (FK)     │
│ rating          │       │ created_at      │
│ comment         │       └─────────────────┘
│ created_at      │               │
└─────────────────┘               │ 1:N
                                  ▼
                          ┌─────────────────┐
                          │    messages     │
                          │─────────────────│
                          │ id (PK)         │
                          │ room_id (FK)    │
                          │ sender_id (FK)  │
                          │ content         │
                          │ read            │
                          │ created_at      │
                          └─────────────────┘
```

### 2.2 테이블 명세

#### 2.2.1 users (사용자)

| 컬럼명 | 데이터타입 | 제약조건 | 설명 |
|--------|-----------|---------|------|
| id | uuid | PK, NOT NULL | 사용자 고유 ID |
| email | varchar(255) | UNIQUE, NOT NULL | 이메일 주소 |
| name | varchar(100) | NOT NULL | 사용자 이름 |
| role | enum | NOT NULL | 역할 (caregiver/guardian) |
| phone | varchar(20) | NULL | 연락처 |
| image | text | NULL | 프로필 이미지 URL |
| profile_completed | boolean | DEFAULT false | 프로필 완성 여부 |
| created_at | timestamp | DEFAULT now() | 생성일시 |
| updated_at | timestamp | DEFAULT now() | 수정일시 |

#### 2.2.2 caregiver_profiles (간병인 프로필)

| 컬럼명 | 데이터타입 | 제약조건 | 설명 |
|--------|-----------|---------|------|
| id | uuid | PK, NOT NULL | 프로필 고유 ID |
| user_id | uuid | FK, NOT NULL | 사용자 ID |
| experience_years | integer | NULL | 경력 (년) |
| certifications | jsonb | NULL | 자격증 목록 |
| introduction | text | NULL | 자기소개 |
| preferred_location | varchar(100) | NULL | 희망 근무지 |
| preferred_salary | integer | NULL | 희망 급여 |
| available | boolean | DEFAULT true | 구직 가능 여부 |
| created_at | timestamp | DEFAULT now() | 생성일시 |
| updated_at | timestamp | DEFAULT now() | 수정일시 |

#### 2.2.3 job_postings (구인글)

| 컬럼명 | 데이터타입 | 제약조건 | 설명 |
|--------|-----------|---------|------|
| id | uuid | PK, NOT NULL | 구인글 고유 ID |
| guardian_id | uuid | FK, NOT NULL | 보호자 ID |
| title | varchar(200) | NOT NULL | 제목 |
| description | text | NOT NULL | 상세 내용 |
| location | varchar(100) | NOT NULL | 근무 지역 |
| salary | integer | NOT NULL | 급여 |
| work_type | enum | NOT NULL | 근무 형태 (입주/출퇴근/시간제) |
| patient_condition | text | NULL | 환자 상태 |
| status | enum | DEFAULT 'open' | 상태 (open/closed/filled) |
| created_at | timestamp | DEFAULT now() | 생성일시 |
| updated_at | timestamp | DEFAULT now() | 수정일시 |

#### 2.2.4 applications (지원)

| 컬럼명 | 데이터타입 | 제약조건 | 설명 |
|--------|-----------|---------|------|
| id | uuid | PK, NOT NULL | 지원 고유 ID |
| job_id | uuid | FK, NOT NULL | 구인글 ID |
| caregiver_id | uuid | FK, NOT NULL | 간병인 ID |
| status | enum | DEFAULT 'pending' | 상태 (pending/accepted/rejected) |
| message | text | NULL | 지원 메시지 |
| created_at | timestamp | DEFAULT now() | 지원일시 |
| updated_at | timestamp | DEFAULT now() | 수정일시 |

#### 2.2.5 reviews (리뷰)

| 컬럼명 | 데이터타입 | 제약조건 | 설명 |
|--------|-----------|---------|------|
| id | uuid | PK, NOT NULL | 리뷰 고유 ID |
| job_id | uuid | FK, NOT NULL | 관련 구인글 ID |
| reviewer_id | uuid | FK, NOT NULL | 작성자 ID |
| reviewee_id | uuid | FK, NOT NULL | 대상자 ID |
| rating | integer | CHECK 1-5 | 평점 (1-5점) |
| comment | text | NOT NULL | 리뷰 내용 |
| created_at | timestamp | DEFAULT now() | 작성일시 |

#### 2.2.6 chat_rooms (채팅방)

| 컬럼명 | 데이터타입 | 제약조건 | 설명 |
|--------|-----------|---------|------|
| id | uuid | PK, NOT NULL | 채팅방 고유 ID |
| guardian_id | uuid | FK, NOT NULL | 보호자 ID |
| caregiver_id | uuid | FK, NOT NULL | 간병인 ID |
| job_id | uuid | FK, NULL | 관련 구인글 ID |
| created_at | timestamp | DEFAULT now() | 생성일시 |

#### 2.2.7 messages (메시지)

| 컬럼명 | 데이터타입 | 제약조건 | 설명 |
|--------|-----------|---------|------|
| id | uuid | PK, NOT NULL | 메시지 고유 ID |
| room_id | uuid | FK, NOT NULL | 채팅방 ID |
| sender_id | uuid | FK, NOT NULL | 발신자 ID |
| content | text | NOT NULL | 메시지 내용 |
| read | boolean | DEFAULT false | 읽음 여부 |
| created_at | timestamp | DEFAULT now() | 발송일시 |

---

## 3. API 설계

### 3.1 API 엔드포인트 목록

| 메서드 | 엔드포인트 | 설명 | 인증 |
|--------|-----------|------|------|
| GET/POST | /api/auth/[...nextauth] | 인증 처리 | - |
| POST | /api/users/complete-profile | 프로필 완성 | 필수 |
| GET/PUT | /api/caregiver/profile | 간병인 프로필 | 필수 |
| GET/POST | /api/jobs | 구인글 목록/등록 | 필수 |
| GET/PUT | /api/guardian/jobs/[id] | 구인글 상세/수정 | 필수 |
| GET/POST | /api/applications | 지원 목록/등록 | 필수 |
| PUT | /api/applications/[id] | 지원 상태 변경 | 필수 |
| GET/POST | /api/reviews | 리뷰 목록/등록 | 필수 |
| GET/POST | /api/chat/rooms | 채팅방 목록/생성 | 필수 |
| GET/POST | /api/chat/rooms/[roomId]/messages | 메시지 조회/발송 | 필수 |

### 3.2 인증 흐름

```
┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐
│  Client  │     │ NextAuth │     │  Kakao/  │     │ Supabase │
│          │     │          │     │  Naver   │     │          │
└────┬─────┘     └────┬─────┘     └────┬─────┘     └────┬─────┘
     │                │                │                │
     │ 1. Login Click │                │                │
     │───────────────►│                │                │
     │                │ 2. Redirect    │                │
     │                │───────────────►│                │
     │                │                │                │
     │                │ 3. Auth Code   │                │
     │                │◄───────────────│                │
     │                │                │                │
     │                │ 4. Get Token   │                │
     │                │───────────────►│                │
     │                │                │                │
     │                │ 5. User Info   │                │
     │                │◄───────────────│                │
     │                │                │                │
     │                │ 6. Upsert User │                │
     │                │───────────────────────────────►│
     │                │                │                │
     │ 7. Session     │                │                │
     │◄───────────────│                │                │
     │                │                │                │
```

---

## 4. 컴포넌트 설계

### 4.1 컴포넌트 구조

```
src/
├── components/
│   ├── layout/
│   │   ├── index.tsx        # Layout 래퍼
│   │   ├── Header.tsx       # 헤더 (네비게이션)
│   │   └── Footer.tsx       # 푸터
│   │
│   ├── ui/                  # shadcn/ui 기반 컴포넌트
│   │   ├── button.tsx
│   │   ├── card.tsx
│   │   ├── input.tsx
│   │   ├── label.tsx
│   │   ├── textarea.tsx
│   │   ├── badge.tsx
│   │   └── avatar.tsx
│   │
│   ├── common/              # 공통 컴포넌트
│   │   ├── ReviewCard.tsx
│   │   └── ReviewForm.tsx
│   │
│   ├── caregiver/           # 간병인 전용 컴포넌트
│   │   └── (future components)
│   │
│   └── guardian/            # 보호자 전용 컴포넌트
│       └── (future components)
│
├── pages/
│   ├── _app.tsx             # App 래퍼
│   ├── _document.tsx        # Document 설정
│   ├── index.tsx            # 홈페이지
│   │
│   ├── auth/
│   │   ├── login.tsx        # 로그인
│   │   ├── register.tsx     # 회원가입
│   │   ├── complete-profile.tsx  # 프로필 완성
│   │   └── error.tsx        # 인증 에러
│   │
│   ├── caregiver/
│   │   ├── dashboard.tsx    # 간병인 대시보드
│   │   ├── profile.tsx      # 프로필 관리
│   │   └── applications.tsx # 지원 현황
│   │
│   ├── guardian/
│   │   ├── dashboard.tsx    # 보호자 대시보드
│   │   └── jobs/
│   │       ├── index.tsx    # 내 구인글 목록
│   │       ├── new.tsx      # 구인글 등록
│   │       └── [id].tsx     # 구인글 상세/수정
│   │
│   ├── jobs/
│   │   ├── index.tsx        # 구인글 목록 (공개)
│   │   └── [id].tsx         # 구인글 상세 (공개)
│   │
│   ├── chat/
│   │   ├── index.tsx        # 채팅방 목록
│   │   └── [roomId].tsx     # 채팅방
│   │
│   ├── reviews/
│   │   ├── index.tsx        # 리뷰 목록
│   │   └── write/[jobId].tsx # 리뷰 작성
│   │
│   └── api/
│       ├── auth/[...nextauth].ts
│       ├── users/complete-profile.ts
│       ├── caregiver/profile.ts
│       ├── jobs/index.ts
│       ├── guardian/jobs/[id].ts
│       ├── applications/index.ts
│       ├── applications/[id].ts
│       ├── reviews/index.ts
│       └── chat/
│           ├── rooms.ts
│           └── rooms/[roomId]/messages.ts
│
├── lib/
│   ├── supabase.ts          # Supabase 클라이언트
│   ├── auth.ts              # NextAuth 설정
│   ├── kakao.ts             # 카카오 알림톡
│   └── utils.ts             # 유틸리티 함수
│
├── hooks/
│   └── (custom hooks)
│
├── types/
│   └── index.ts             # TypeScript 타입 정의
│
└── styles/
    └── globals.css          # 전역 스타일
```

### 4.2 상태 관리

| 영역 | 방식 | 설명 |
|------|------|------|
| 서버 상태 | SWR / fetch | API 데이터 캐싱 및 갱신 |
| 클라이언트 상태 | React useState | 로컬 UI 상태 |
| 인증 상태 | NextAuth useSession | 세션 관리 |
| 실시간 상태 | Supabase Realtime | 채팅 메시지 |

---

## 5. 보안 설계

### 5.1 Row Level Security (RLS)

```sql
-- 사용자는 자신의 데이터만 접근 가능
CREATE POLICY "Users can view own profile"
ON users FOR SELECT
USING (auth.uid() = id);

-- 간병인 프로필은 본인만 수정 가능
CREATE POLICY "Caregivers can update own profile"
ON caregiver_profiles FOR UPDATE
USING (auth.uid() = user_id);

-- 구인글은 작성자만 수정 가능
CREATE POLICY "Guardians can update own job postings"
ON job_postings FOR UPDATE
USING (auth.uid() = guardian_id);
```

### 5.2 API 인증

모든 API 요청은 NextAuth.js 세션을 통해 인증됩니다:

```typescript
// API 라우트 인증 예시
const session = await getServerSession(req, res, authOptions)
if (!session) {
  return res.status(401).json({ error: '로그인이 필요합니다' })
}
```

---

## 6. 성능 최적화

### 6.1 프론트엔드 최적화

| 기법 | 적용 내용 |
|------|----------|
| 코드 분할 | 페이지별 자동 코드 스플리팅 |
| 이미지 최적화 | Next.js Image 컴포넌트 사용 |
| 폰트 최적화 | next/font를 통한 폰트 최적화 |
| 캐싱 | 정적 자원 브라우저 캐싱 |

### 6.2 백엔드 최적화

| 기법 | 적용 내용 |
|------|----------|
| 서버리스 함수 | Vercel Edge Functions |
| DB 인덱싱 | 주요 쿼리 컬럼 인덱스 |
| 연결 풀링 | Supabase 연결 풀 사용 |

---

*본 문서는 케어매치 V3 시스템의 기술 설계를 담고 있습니다.*
